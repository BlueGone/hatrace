#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

void die_usage(void)
{
  fprintf(stderr, "Usage: execve argv0 [argv1...]\n");
  exit(1);
}

int main(int argc, char *const argv[])
{
  if (argc < 2) {
    die_usage();
  }

  // Per `man 2 execve`:
  //     On Linux, argv and envp can be specified as NULL.
  //     In both cases, this has the same effect as specifying the argument
  //     as a pointer to a list containing a single null pointer.
  //     Do not take advantage of this nonstandard and nonportable misfeature!
  //     On many other UNIX systems, specifying argv as NULL will result in
  //     an error (EFAULT).
  //     Some other UNIX systems treat the envp==NULL case the same as Linux.
  // We do exactly that here.
  execve(argv[1], &argv[1], NULL);

  // If execve returns, an error occurred.

  const size_t errmsg_len = sizeof "execve: " + strlen(argv[1]) + 1;
  char errmsg[errmsg_len];
  snprintf(errmsg, errmsg_len, "execve: %s", argv[1]);

  perror(errmsg);

  exit(1);
}
